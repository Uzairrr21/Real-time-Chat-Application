{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DELL\\\\OneDrive\\\\Desktop\\\\mern-chat-app\\\\frontend\\\\src\\\\context\\\\ChatContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect, useContext, useCallback } from 'react';\nimport axios from 'axios';\nimport { io } from 'socket.io-client';\nimport AuthContext from './AuthContext';\n\n// Create and export the context\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ChatContext = /*#__PURE__*/createContext();\nexport const ChatProvider = ({\n  children\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [typingUsers, setTypingUsers] = useState([]);\n  const [socket, setSocket] = useState(null);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\n  const {\n    user,\n    isAuthenticated,\n    token,\n    logout\n  } = useContext(AuthContext);\n\n  // Stable WebSocket connection\n  const connectSocket = useCallback(() => {\n    if (!isAuthenticated || !token) return;\n    const newSocket = io('http://localhost:5000', {\n      path: '/socket.io/',\n      auth: {\n        token\n      },\n      transports: ['websocket'],\n      reconnection: true,\n      reconnectionAttempts: Infinity,\n      reconnectionDelay: 1000,\n      reconnectionDelayMax: 5000,\n      timeout: 10000\n    });\n    newSocket.on('connect', () => {\n      setConnectionStatus('connected');\n      console.log('Socket connected');\n    });\n    newSocket.on('disconnect', reason => {\n      setConnectionStatus('disconnected');\n      console.log('Socket disconnected:', reason);\n    });\n    newSocket.on('connect_error', err => {\n      setConnectionStatus('error');\n      console.error('Connection error:', err);\n    });\n    newSocket.on('message', message => {\n      setMessages(prev => [...prev, message]);\n    });\n    newSocket.on('onlineUsers', users => {\n      setOnlineUsers(users);\n    });\n    newSocket.on('typing', ({\n      userId,\n      isTyping\n    }) => {\n      setTypingUsers(prev => isTyping ? [...prev.filter(id => id !== userId), userId] : prev.filter(id => id !== userId));\n    });\n    setSocket(newSocket);\n    return () => {\n      newSocket.disconnect();\n    };\n  }, [isAuthenticated, token]);\n  useEffect(() => {\n    const cleanup = connectSocket();\n    return cleanup;\n  }, [connectSocket]);\n\n  // Fetch messages\n  const fetchMessages = useCallback(async () => {\n    try {\n      const res = await axios.get('/api/messages', {\n        headers: {\n          'x-auth-token': token\n        }\n      });\n      setMessages(res.data);\n    } catch (err) {\n      var _err$response;\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) logout();\n      console.error('Error fetching messages:', err);\n    }\n  }, [token, logout]);\n  useEffect(() => {\n    if (isAuthenticated) fetchMessages();\n  }, [isAuthenticated, fetchMessages]);\n\n  // Send message\n  const sendMessage = async content => {\n    try {\n      if (!socket || !socket.connected) {\n        throw new Error('Not connected to server');\n      }\n      const res = await axios.post('/api/messages', {\n        content\n      }, {\n        headers: {\n          'x-auth-token': token\n        }\n      });\n      socket.emit('message', res.data);\n      return res.data;\n    } catch (err) {\n      var _err$response2, _err$response3;\n      if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) logout();\n      console.error('Error sending message:', err);\n      throw ((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : _err$response3.data) || {\n        message: 'Failed to send message'\n      };\n    }\n  };\n\n  // Typing indicator\n  const sendTyping = isTyping => {\n    if (socket && socket.connected) {\n      socket.emit('typing', {\n        isTyping\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(ChatContext.Provider, {\n    value: {\n      messages,\n      onlineUsers,\n      typingUsers,\n      sendMessage,\n      sendTyping,\n      fetchMessages,\n      connectionStatus\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 5\n  }, this);\n};\n\n// Export both named and default exports\n_s(ChatProvider, \"FV6qlvwLh7YW4+z5nLm9OBKFTcY=\");\n_c = ChatProvider;\nexport { ChatContext as default };\nvar _c;\n$RefreshReg$(_c, \"ChatProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","useContext","useCallback","axios","io","AuthContext","jsxDEV","_jsxDEV","ChatContext","ChatProvider","children","_s","messages","setMessages","onlineUsers","setOnlineUsers","typingUsers","setTypingUsers","socket","setSocket","connectionStatus","setConnectionStatus","user","isAuthenticated","token","logout","connectSocket","newSocket","path","auth","transports","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","timeout","on","console","log","reason","err","error","message","prev","users","userId","isTyping","filter","id","disconnect","cleanup","fetchMessages","res","get","headers","data","_err$response","response","status","sendMessage","content","connected","Error","post","emit","_err$response2","_err$response3","sendTyping","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","default","$RefreshReg$"],"sources":["C:/Users/DELL/OneDrive/Desktop/mern-chat-app/frontend/src/context/ChatContext.js"],"sourcesContent":["import { createContext, useState, useEffect, useContext, useCallback } from 'react';\r\nimport axios from 'axios';\r\nimport { io } from 'socket.io-client';\r\nimport AuthContext from './AuthContext';\r\n\r\n// Create and export the context\r\nexport const ChatContext = createContext();\r\n\r\nexport const ChatProvider = ({ children }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const [typingUsers, setTypingUsers] = useState([]);\r\n  const [socket, setSocket] = useState(null);\r\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\r\n  const { user, isAuthenticated, token, logout } = useContext(AuthContext);\r\n\r\n  // Stable WebSocket connection\r\n  const connectSocket = useCallback(() => {\r\n    if (!isAuthenticated || !token) return;\r\n\r\n    const newSocket = io('http://localhost:5000', {\r\n      path: '/socket.io/',\r\n      auth: { token },\r\n      transports: ['websocket'],\r\n      reconnection: true,\r\n      reconnectionAttempts: Infinity,\r\n      reconnectionDelay: 1000,\r\n      reconnectionDelayMax: 5000,\r\n      timeout: 10000\r\n    });\r\n\r\n    newSocket.on('connect', () => {\r\n      setConnectionStatus('connected');\r\n      console.log('Socket connected');\r\n    });\r\n\r\n    newSocket.on('disconnect', (reason) => {\r\n      setConnectionStatus('disconnected');\r\n      console.log('Socket disconnected:', reason);\r\n    });\r\n\r\n    newSocket.on('connect_error', (err) => {\r\n      setConnectionStatus('error');\r\n      console.error('Connection error:', err);\r\n    });\r\n\r\n    newSocket.on('message', (message) => {\r\n      setMessages(prev => [...prev, message]);\r\n    });\r\n\r\n    newSocket.on('onlineUsers', (users) => {\r\n      setOnlineUsers(users);\r\n    });\r\n\r\n    newSocket.on('typing', ({ userId, isTyping }) => {\r\n      setTypingUsers(prev => \r\n        isTyping \r\n          ? [...prev.filter(id => id !== userId), userId]\r\n          : prev.filter(id => id !== userId)\r\n      );\r\n    });\r\n\r\n    setSocket(newSocket);\r\n    return () => {\r\n      newSocket.disconnect();\r\n    };\r\n  }, [isAuthenticated, token]);\r\n\r\n  useEffect(() => {\r\n    const cleanup = connectSocket();\r\n    return cleanup;\r\n  }, [connectSocket]);\r\n\r\n  // Fetch messages\r\n  const fetchMessages = useCallback(async () => {\r\n    try {\r\n      const res = await axios.get('/api/messages', {\r\n        headers: { 'x-auth-token': token }\r\n      });\r\n      setMessages(res.data);\r\n    } catch (err) {\r\n      if (err.response?.status === 401) logout();\r\n      console.error('Error fetching messages:', err);\r\n    }\r\n  }, [token, logout]);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) fetchMessages();\r\n  }, [isAuthenticated, fetchMessages]);\r\n\r\n  // Send message\r\n  const sendMessage = async (content) => {\r\n    try {\r\n      if (!socket || !socket.connected) {\r\n        throw new Error('Not connected to server');\r\n      }\r\n      \r\n      const res = await axios.post('/api/messages', { content }, {\r\n        headers: { 'x-auth-token': token }\r\n      });\r\n      socket.emit('message', res.data);\r\n      return res.data;\r\n    } catch (err) {\r\n      if (err.response?.status === 401) logout();\r\n      console.error('Error sending message:', err);\r\n      throw err.response?.data || { message: 'Failed to send message' };\r\n    }\r\n  };\r\n\r\n  // Typing indicator\r\n  const sendTyping = (isTyping) => {\r\n    if (socket && socket.connected) {\r\n      socket.emit('typing', { isTyping });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ChatContext.Provider value={{ \r\n      messages, \r\n      onlineUsers, \r\n      typingUsers, \r\n      sendMessage, \r\n      sendTyping,\r\n      fetchMessages,\r\n      connectionStatus\r\n    }}>\r\n      {children}\r\n    </ChatContext.Provider>\r\n  );\r\n};\r\n\r\n// Export both named and default exports\r\nexport { ChatContext as default };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}